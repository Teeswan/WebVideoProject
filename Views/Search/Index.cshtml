@model (IEnumerable<Youtube_Entertainment_Project.DTOs.ChannelDto> Channels, IEnumerable<Youtube_Entertainment_Project.DTOs.VideoDto> Videos)

<style>
    .video-preview-scroll {
        scrollbar-width: none; 
        -ms-overflow-style: none; 
    }

        .video-preview-scroll::-webkit-scrollbar {
            display: none; 
        }

    .video-preview-scroll {
        scroll-behavior: smooth;
    }

    .video-preview-item:hover img {
        filter: brightness(0.8);
        transition: 0.3s;
    }

    .video-thumbnail-container {
        position: relative;
        display: block;
    }

    .play-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.3s ease;
        border-radius: 0.5rem;
    }

        .play-overlay i {
            color: white;
            font-size: 2rem;
        }

    .video-thumbnail-container:hover .play-overlay {
        opacity: 1;
    }
</style>

<div class="container mt-4">
    <h4 class="mb-4">Results for "@ViewBag.Query"</h4>

    @if (Model.Channels.Any())
    {
        <div class="mb-5">
            <h5 class="border-bottom pb-2">Channels</h5>
            @foreach (var channel in Model.Channels)
            {
                <div class="d-flex align-items-start py-4 border-bottom">
                    <div class="me-4 text-center" style="min-width: 120px;">
                        @{
                            var profilePic = string.IsNullOrEmpty(channel.OwnerProfileImagePath)
                            ? "/images/default-profile.png"
                            : channel.OwnerProfileImagePath;

                            if (!profilePic.StartsWith("/") && !profilePic.StartsWith("http"))
                            {
                                profilePic = "/" + profilePic;
                            }
                        }
                        <a asp-controller="Channel" asp-action="Details" asp-route-id="@channel.ChannelId">
                            <img src="@profilePic"
                                 class="rounded-circle shadow-sm"
                                 style="width: 120px; height: 120px; object-fit: cover; border: 2px solid #eee;"
                                 alt="@channel.Name" />
                        </a>
                    </div>

                    <div class="flex-grow-1">
                        <h5 class="fw-bold mb-1">@channel.Name</h5>
                        <p class="text-muted small mb-2">@channel.Description</p>
                        <p class="text-muted small mb-3">
                            <i class="bi bi-play-rect"></i> @(channel.Videos?.Count ?? 0) Videos
                        </p>

                        <a asp-controller="Channel" asp-action="Details" asp-route-id="@channel.ChannelId"
                           class="btn btn-sm btn-dark rounded-pill px-4 mb-3">Visit Channel</a>

                        @if (channel.Videos != null && channel.Videos.Any())
                        {
                            <div class="mt-2 d-flex gap-2 overflow-auto pb-2" style="scrollbar-width: none;">
                                @foreach (var v in channel.Videos.Take(3))
                                {
                                    <div style="width: 160px; min-width: 160px;">
                                        <a asp-controller="Video" asp-action="Details" asp-route-id="@v.VideoId" class="text-decoration-none text-dark">

                                            <div class="video-thumbnail-container">
                                                <img src="@(string.IsNullOrEmpty(v.ThumbnailUrl) ? "/images/default-thumbnail.jpg" : v.ThumbnailUrl)"
                                                     class="img-fluid rounded shadow-sm"
                                                     style="aspect-ratio: 16/9; object-fit: cover;" />

                                                <div class="play-overlay">
                                                    <i class="bi bi-play-fill"></i> 
                                                </div>
                                            </div>

                                            <p class="small text-truncate mt-1 mb-0" style="font-size: 0.8rem; font-weight: 500;">@v.Title</p>
                                        </a>
                                    </div>
                                }
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    }

    <h5 class="border-bottom pb-2">Videos</h5>
    @if (Model.Videos.Any())
    {
        @foreach (var v in Model.Videos)
        {
            <div class="row mb-4 align-items-start">
                <div class="col-md-4 col-lg-3">
                    <a asp-controller="Video" asp-action="Details" asp-route-id="@v.VideoId">
                        <img src="@(string.IsNullOrEmpty(v.ThumbnailUrl) ? "/images/default-thumbnail.jpg" : v.ThumbnailUrl)"
                             class="img-fluid rounded-3 shadow-sm" style="aspect-ratio: 16/9; object-fit: cover;" />
                    </a>
                </div>
                <div class="col-md-8 col-lg-9">
                    <h5 class="fw-bold mb-1">
                        <a asp-controller="Video" asp-action="Details" asp-route-id="@v.VideoId" class="text-dark text-decoration-none">@v.Title</a>
                    </h5>
                    <p class="text-muted small mb-1">@v.ChannelName • @v.ViewCount views • @v.CreatedAt.ToString("MMM dd, yyyy")</p>
                    <p class="text-muted small text-truncate" style="max-height: 50px;">@v.Description</p>

                    @if (v.Visibility != "public")
                    {
                        <span class="badge bg-danger rounded-pill"><i class="bi bi-lock-fill"></i> Private</span>
                    }
                </div>
            </div>
        }
    }
    else
    {
        <div class="text-center py-5 bg-light rounded-4">
            <i class="bi bi-search display-1 text-muted"></i>
            <p class="mt-3 fs-5">No videos found for this search.</p>
        </div>
    }
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const scrollContainers = document.querySelectorAll('.video-preview-scroll');

            scrollContainers.forEach(container => {
                container.addEventListener("wheel", (evt) => {
                    if (evt.deltaY !== 0) {
                        evt.preventDefault();
                        container.scrollLeft += evt.deltaY;
                    }
                });
            });
        });
    </script>
}
